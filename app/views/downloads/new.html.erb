<% previous_tags = get_previous_uploaded_download_tags %>
<!-- All Dashboard Start -->
<div id="New_Download" ng-app="New_Download" >
<div ng-controller="NewDownloadCtrl as ctrl">
<section class="clearfix container-fluid-full">
  <div class="row-fluid">
    <div class="sidebar-left">
         <%= render 'layouts/navigation' %>
    </div>
    <div class="content clearfix" >
      <div class="clearfix job-post-bread">
         <ul class="breadcrumb">
          <li><%= link_to 'Downloads', index_download_path %></li>
            <li class="active">
               <% actiontype = '' %>
                <% if 'edit' == params[:action] || 'update' == params[:action] 
                        actiontype = update_download_path
                %>
                    Edit Download
                <% else
                        actiontype = save_download_path
                 %>
                    Create Download
                <% end %>

            </li>
        </ul>
      </div>
      
      <!-- User Followers Start -->
      <section class="clearfix jobswrap">
      <%= form_for( @download, url: actiontype, html: { id: 'download_post_form',  role: "form" }) do |f| %>
        <%= f.hidden_field :user_id, value: current_user.id, id: 'gallery_user_id' %>   
        <%= f.hidden_field :is_admin, value: 'N', id: 'gallery_is_admin' %>      
        <%= f.hidden_field :removedids, value: '', id: 'gallery_removedids' %>      
        <%= f.hidden_field :removedimages, value: '', id: 'gallery_removedimages' %>      
        <%= f.hidden_field :removedvideourl, value: '', id: 'gallery_removedvideourl' %>      
        <%= f.hidden_field :removedsketchfab, value: '', id: 'gallery_removedsketchfab' %>      
        <%= f.hidden_field :removedUploadVideo, value: '', id: 'gallery_removedUploadVideo' %>      
        <%= f.hidden_field :removedMarmoset, value: '', id: 'gallery_removedMarmoset' %>   
        <%= f.hidden_field :removedZip, value: '', id: 'gallery_removedzip' %>   
        <%= f.hidden_field :removedZipNew, value: '', id: 'gallery_removedzip_new' %>   
         <div id="hiddendata"></div>
        <div class="clearfix notification-heading">  
            <span class="noti-title" style="border:none;"> 
                <% if 'edit' == params[:action] || 'update' == params[:action] %>
                    <%= @download.title %>
                <% else %>
                    Untitled Download
                <% end %>
            </span> </div>
        <div class="jobpostindent clearfix col-sm-12 col-xs-12 padding">
          
          <div class="clearfix marginB15 jobpostbox border-radius">
                        <ul>
                            <li><a href="javascript:void(0);" ng-click="addNewImages()"><i class="fa fa-upload marginR5 blue-txt" aria-hidden="true"></i> Add Images</a></li>
                            <li><a data-toggle="modal" href="#add-video-popup" ><i class="fa fa-film marginR5 blue-txt" aria-hidden="true"></i> Add Video</a></li>
                            <li class="dropdown-toggle">
                                <a href="javascript:void(0);" data-toggle="dropdown"><i class="fa fa-codepen marginR5 blue-txt" aria-hidden="true"></i> Add 3D Model <i class="fa fa-caret-down blue-txt pull-right marginL5" aria-hidden="true"></i></a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a data-toggle="modal" href="#add-sketchfab-popup">Add Sketchfab Model</a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);" ng-click="addNewMarmoSets()">Add Marmoset Viewer</a>

                                        <!-- <a href="javascript:void(0);">Add Marmoset Viewer</a> -->
                                    </li>
                                </ul>
                            </li>


                            <li>
                                <!-- <a href="javascript:void(0);"><i class="fa fa-file-video-o marginR5 blue-txt" aria-hidden="true"></i> Upload Video</a> -->
                                <a href="javascript:void(0);" ng-click="addNewUploadVideos()"><i class="fa fa-file-video-o marginR5 blue-txt" aria-hidden="true"></i> Upload Video</a>
                            </li>
                            <!-- <li><a href="javascript:void(0);" ng-click="addNewZip()"><i class="fa fa-upload marginR5 blue-txt" aria-hidden="true"></i> Add Zip/Rar Files</a></li>  -->   
                        </ul>
                    </div>

                    <div class="marginB15 dragdrop text-center hidden-sm hidden-xs" >
                        <input accept="image/*" id='gallery_image_image_999' name='download[avatar][][image]' type='file' multiple="multiple" class='dragdrop-gallery'>
                        <div class="marginB15"><i class="fa fa-files-o fa-2x" aria-hidden="true"></i></div>
                         <div class="marginB15">Drag and drop your images here</div> 
                        <button class="lightbtn padding10 lightcolor" type="button" ng-click="addNewImages()">Select Files</button>
                    </div>

                     <div class="clearfix marginB15 selectgallery">
                        <ul>

                        <!-- Edit Mode Update Images list -->
                            <li ng-repeat="x in add_images_default" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="lidefault{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeImageDefault($index, x.id)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="{{x.image.large_image.url}}" alt="image" class="img-responsive img-preview" id="gallery_image_view_default_{{$index}}" >
                                    </center>
                                    
                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[images_attributes_default][{{x.id}}][caption_image]" id="gallery_image_caption_image_default_{{$index}}" placeholder="Enter caption">{{x.caption_image}}</textarea>
                                    </div>
                                </div>

                            </li>

                            <!-- Add Images list -->
                            <li ng-repeat="x in add_images" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15 hidden" id="li{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeImage($index)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="image" class="img-responsive img-preview" id="gallery_image_view_{{$index}}" >
                                    </center>
                                    <input type="file" name="download[images_attributes][{{$index}}][image]" id="gallery_image_image_{{$index}}" ng-show="false" accept="image/*" onchange="angular.element(this).scope().newImageUpload(this)" >


                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[images_attributes][{{$index}}][caption_image]" id="gallery_image_caption_image_{{$index}}" placeholder="Enter caption"></textarea>
                                    </div>
                                </div>

                            </li>

                            <!-- Edit Mode Update Video URL list -->
                            <li ng-repeat="x in add_video_url_default" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="livideourldefault{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-film" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeVideoURLDefault($index, x.id)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Video Url" class="img-responsive img-preview" id="gallery_video_url_image_view_default_{{$index}}" >
                                    </center>

                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[videos_attributes_default][{{x.id}}][caption_video]" id="gallery_videos_caption_video_default_{{$index}}" placeholder="Enter caption">{{x.caption_video}}</textarea>
                                    </div>
                                </div>

                            </li>

                            <!-- Add Video URL list -->
                            <li ng-repeat="x in add_video_url" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="livideourl{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-film" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeVideoURL($index)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Video Url" class="img-responsive img-preview" id="gallery_video_url_image_view_{{$index}}" >
                                    </center>

                                    <input type="hidden" name="download[videos_attributes][{{$index}}][video]" id="gallery_videos_video_{{$index}}" />

                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[videos_attributes][{{$index}}][caption_video]" id="gallery_videos_caption_video_{{$index}}" placeholder="Enter caption"></textarea>
                                    </div>
                                </div>

                            </li>

                            <!-- Edit Mode Update Sketchfab URL list -->
                            <li ng-repeat="x in add_sketchfab_url_default" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="lisketchfaburldefault{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-codepen" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeSketchfabURLDefault($index, x.id)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Sketchfab" class="img-responsive img-preview" id="gallery_sketchfab_url_image_view_default_{{$index}}" >
                                    </center>

                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[sketchfebs_attributes_default][{{x.id}}][caption_sketchfeb]" id="gallery_sketchfebs_caption_sketchfeb_default_{{$index}}" placeholder="Enter caption">{{x.caption_sketchfeb}}</textarea>
                                    </div>

                                </div>

                            </li>


                            <!-- Add Sketchfab URL list -->
                            <li ng-repeat="x in add_sketchfab_url" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="lisketchfaburl{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-codepen" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeSketchfabURL($index)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Sketchfab" class="img-responsive img-preview" id="gallery_sketchfab_url_image_view_{{$index}}" >
                                    </center>

                                    <input type="hidden" name="download[sketchfebs_attributes][{{$index}}][sketchfeb]" id="gallery_sketchfebs_sketchfeb_{{$index}}" /> 

                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[sketchfebs_attributes][{{$index}}][caption_sketchfeb]" id="gallery_sketchfebs_caption_sketchfeb_{{$index}}" placeholder="Enter caption"></textarea>
                                    </div>

                                </div>

                            </li>

                            <!-- Edit Mode Update Upload Videos list -->
                            <li ng-repeat="x in add_upload_videos_default" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="liuploadvideodefault{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-file-video-o" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeUploadVideoDefault($index, x.id)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Upload video" class="img-responsive img-preview" id="gallery_upload_video_view_default_{{$index}}" >
                                    </center>

                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[upload_videos_attributes_default][{{x.id}}][caption_upload_video]" id="gallery_upload_videos_caption_upload_video_default_{{$index}}" placeholder="Enter caption">{{x.caption_upload_video}}</textarea>
                                    </div>
                                </div>

                            </li>

                            <!-- Add Upload Videos list -->
                            <li ng-repeat="x in add_upload_videos" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15 hidden" id="liuploadvideo{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-file-video-o" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeUploadVideo($index)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Upload video" class="img-responsive img-preview" id="gallery_upload_video_view_{{$index}}" >
                                    </center>
                                    <input type="file" name="download[upload_videos_attributes][{{$index}}][uploadvideo]" id="gallery_upload_videos_uploadvideo_{{$index}}" ng-show="false" accept="video/*" onchange="angular.element(this).scope().newVideoUpload(this)" >

                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[upload_videos_attributes][{{$index}}][caption_upload_video]" id="gallery_upload_videos_caption_upload_video_{{$index}}" placeholder="Enter caption"></textarea>
                                    </div>
                                </div>

                            </li>

                            <!-- Edit Mode Update Marmosets list -->
                            <li ng-repeat="x in add_marmo_sets_default" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="limarmosetdefault{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeMarmoSetDefault($index, x.id)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Marmoset" class="img-responsive img-preview" id="gallery_marmo_set_view_default_{{$index}}" >
                                    </center>
                                    
                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[marmo_sets_attributes_default][{{x.id}}][caption_marmoset]" id="gallery_marmo_sets_caption_marmoset_default_{{$index}}" placeholder="Enter caption">{{x.caption_marmoset}}</textarea>
                                    </div>
                                </div>

                            </li>

                            <!-- Add Marmosets -->
                            <li ng-repeat="x in add_marmo_sets" class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15 hidden" id="limarmoset{{$index}}">

                                <div class="galleryselect clearfix">
                                    <div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span> <span class="pull-right"><a href="javascript:void(0);" ng-click="removeMarmoSet($index)" class="fa fa-times" aria-hidden="true"></a></span> </div>
                                    <center>
                                        <img src="" alt="Marmoset" class="img-responsive img-preview" id="gallery_marmo_set_view_{{$index}}" >
                                    </center>
                                    <input type="file" name="download[marmo_sets_attributes][{{$index}}][marmoset]" id="gallery_marmo_sets_marmoset_{{$index}}" ng-show="false" accept=".mview" onchange="angular.element(this).scope().newMarmoSet(this)" >
                                    
                                    <div class="clearfix padding10">
                                        <textarea class="form-control reel-txt" name="download[marmo_sets_attributes][{{$index}}][caption_marmoset]" id="gallery_marmo_sets_caption_marmoset_{{$index}}" placeholder="Enter caption"></textarea>
                                    </div>
                                </div>

                            </li>

                            <div id='output'></div>
                        </ul>
                    </div>

                  <div class="marginB15">
                      <label class="marginB15">* Title</label>
                    <%= f.text_field :title, class: 'form-control from-input skill-input', id: 'title', placeholder: 'Product Title', value: params[:download].present? ? params[:download][:title] : @download[:title] %>
                    <span class="err-msg"><%= form_error_msg_for(@download,:title, "Title") %></span>
                  </div>
                  <div class="panel panel-default">
                    <div class="panel-heading padding"><!--  <img src="images/database/txt-job-post.jpg" class="img-responsive" alt="img">  --></div>
                    <div class="panel-body">
                      <%= f.text_area :description, class: 'form-control from-input message-form1 tinymce', id: 'description', placeholder: 'Download Description', :value => params[:download].present? ? params[:download][:description] : @download[:description] %>
                      <span class="err-msg"><%= form_error_msg_for(@download,:description, "Description") %></span>
                    </div>
                  </div>

          <div class="panel panel-default">
            <div class="panel-heading">Product Details</div>
            <div class="panel-body">

                <div class="row">
                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Product Type</label>
                        <div class="col-md-12 col-sm-12 col-xs-10">

                           <select class="form-control multi-select js-chosen-select-multi" multiple="multiple" name="download[post_type_id][]" id="post_type_id">
                                <% if @post_type.present? 
                                  @post_type.each_with_index do |value, index|  
                                %>

                                    <% selected_post_type = ''
                                        if params[:download].present? && !params[:download][:post_type_id].nil? && params[:download][:post_type_id].include?(value.id.to_s)
                                            selected_post_type = 'selected="selected"'
                                        elsif !@download[:post_type_id].nil? && @download[:post_type_id].include?(value.id.to_s)
                                            selected_post_type = 'selected="selected"'
                                        end %>

                                        <option value="<%= value.id %>" <%= selected_post_type %> ><%= value.type_name %></option>

                                <% end
                                end %> 
                            </select>
                         </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Product Category</label>
                        <div class="col-md-12 col-sm-12 col-xs-10">
                           <%= f.select(:post_type_category_id, options_for_select([]), {:include_blank => false}, {'class' => 'form-control multi-select js-chosen-select-multi', 'id' => 'post_type_category_id', multiple: true})  %>
                         </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Product Sub Category</label>
                        <div class="col-md-12 col-sm-12 col-xs-10">
                           <%= f.select(:sub_category_id, options_for_select([]), {:include_blank => false}, {'class' => 'form-control multi-select js-chosen-select-multi', 'id' => 'sub_category_id', multiple: true})  %>
                         </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Price ($)</label>
                        <div class="col-md-6 col-sm-6 col-xs-5 col-md-offset-0">
                            <%= f.text_field :price, 'only-numbers' => 'only-numbers', class: 'form-control from-input', id: 'price', placeholder: '', value: params[:download].present? ? params[:download][:price] : @download[:price] %>
                        </div>

                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10 padding">
                          <div class="checkbox-btn paddinT10">
                           <%= f.check_box :free, id: 'rcfree', name: "download[free]" %>
                            <label for="rcfree" onclick>Share For Free</label>
                          </div>
                        </div>

                    </div>

                    <div class="form-group clearfix">

                    <div class="col-md-12">
                        <div class="marginB15 dragdrop new-drag-drop text-center hidden-sm hidden-xs" >
                            <input accept=".zip,.rar" id='gallery_zip_image_999' name='download[custom_zip][][zipfile]' type='file' multiple="multiple" class="dragdrop-gallery addMoreBtn">
                            <div class="marginB15"><i class="fa fa-files-o fa-2x" aria-hidden="true"></i></div>
                             <div class="marginB15">Drag and drop Zip/Rar file here</div> 
                            
                        </div>
                    </div>


                        <!-- <div class="col-md-12 col-sm-12 col-xs-12 marginB10">
                            <input type="file" name="download[custom_zip][][zipfile]" id="gallery_zip_image_999" accept=".zip,.rar" multiple="multiple" class="addMoreBtn">
                        </div>  -->

                        


                        <div class="col-md-12 col-sm-12 col-xs-12 marginB10">
                            <a href="javascript:void(0);" ng-click="addNewZip()" title="Click to add more Zip Files"><i class="fa fa-upload marginR5 blue-txt" aria-hidden="true"></i> Add Zip/Rar Files</a>
                        </div>

                        <!-- Edit Mode Update zip list -->
                        <div ng-repeat="x in add_zip_default" class="col-md-12 col-sm-12 col-xs-12 marginB10" id="lizipdefault{{$index}}">
                            <div class="galleryselect clearfix">
                                <div class="gallery-select-top clearfix">
                                    <span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span>
                                    <span class="pull-left marginL10" id="gallery_zip_view_default_{{$index}}">{{x.zipfile.url.split("/")[x.zipfile.url.split("/").length-1]}}</span>
                                    <button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" ng-click="removeZipDefault($index, x.id)" title="Remove Zip File">Remove Zip File<span class="fa fa-times marginL10" aria-hidden="true"></span></button>
                                </div>

                                <div class="clearfix padding10">
                                    <textarea class="form-control reel-txt" name="download[zip_files_attributes_default][{{x.id}}][zip_caption]" id="gallery_zip_caption_image_default_{{$index}}" placeholder="Enter caption">{{x.zip_caption}}</textarea>
                                </div>

                                <div ng-repeat="y in x.software track by $index" id="lizip_child_default{{$parent.$index}}_{{$index}}">

                                    <div class="form-group clearfix marginB10">
                                        <div class="gallery-select-top clearfix">
                                            <button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" ng-click="removeSoftwareDefault($parent.$index, $index)" title="Remove Software and Renderer">Remove<span class="fa fa-times marginL10" aria-hidden="true"></span></button>
                                        </div>

                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <select class="custom-select" name="download[zip_files_attributes_default][{{x.id}}][software_renderer][{{$index}}][software]" id="gallery_zip_software_used_{{$parent.$index}}_{{$index}}">
                                                <option  ng-repeat="s in software_expertise_options" value="{{s[1]}}" ng-selected="s[1] == x.software[$parent.$index] ? true : false">{{s[0]}}</option>
                                            </select>
                                        </div>
                                        
                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <input type="text" name="download[zip_files_attributes_default][{{x.id}}][software_renderer][{{$index}}][software_version]" id="gallery_zip_software_version_{{$parent.$index}}_{{$index}}" class="form-control from-input" placeholder="Enter Software Version" value="{{x.software_version[$index]}}">
                                        </div>

                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <select class="custom-select" name="download[zip_files_attributes_default][{{x.id}}][software_renderer][{{$index}}][renderer]" id="gallery_zip_renderer_{{$parent.$index}}_{{$index}}">
                                                <option  ng-repeat="r in renderer_options" value="{{r[1]}}" ng-selected="r[1] == x.renderer[$parent.$index] ? true : false" >{{r[0]}}</option>
                                            </select>
                                        </div>

                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <input type="text" name="download[zip_files_attributes_default][{{x.id}}][software_renderer][{{$index}}][renderer_version]" id="gallery_zip_renderer_version_{{$parent.$index}}_{{$index}}" class="form-control from-input" placeholder="Enter Renderer Version" value="{{x.renderer_version[$index]}}">
                                        </div>
                                    </div>
                                </div>

                                <div class="gallery-select-top clearfix col-md-12 col-sm-12 col-xs-12">
                                    <button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" ng-click="addMoreSoftwareDefault($index)" title="Add More Software and Renderer">Add More<span class="fa fa-plus marginL10" aria-hidden="true"></span></button>
                                </div>

                            </div>

                        </div>

                        <div ng-repeat="x in add_zip" id="lizip{{$index}}" class="hidden col-md-12 col-sm-12 col-xs-12 marginB10">
                            <div class="galleryselect clearfix">
                                <div class="gallery-select-top clearfix">
                                    <span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span>
                                    <span class="pull-left marginL10" id="gallery_zip_view_{{$index}}"></span>
                                    <button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" ng-click="removeZip($index)" title="Remove Zip File">Remove Zip File<span class="fa fa-times marginL10" aria-hidden="true"></span></button>
                                </div>
                                
                                <input type="file" name="download[zip_files_attributes][{{$index}}][zipfile]" id="gallery_zip_image_{{$index}}" ng-show="false" accept=".zip,.rar" onchange="angular.element(this).scope().newZipUpload(this)" class="addMoreBtn">

                                <div class="clearfix padding10">
                                    <textarea class="form-control reel-txt" name="download[zip_files_attributes][{{$index}}][zip_caption]" id="gallery_zip_caption_image_{{$index}}" placeholder="Enter caption"></textarea>
                                </div>

                                <div ng-repeat="y in zip_software_count[$index]" id="lizip_child{{$parent.$index}}_{{$index}}">

                                    <div class="form-group clearfix marginB10">
                                        <div class="gallery-select-top clearfix">
                                            <button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" ng-click="removeSoftware($parent.$index, $index)" title="Remove Software and Renderer">Remove<span class="fa fa-times marginL10" aria-hidden="true"></span></button>
                                        </div>

                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <select class="custom-select" name="download[zip_files_attributes][{{$parent.$index}}][software_renderer][{{$index}}][software]" id="gallery_zip_software_used_{{$parent.$index}}_{{$index}}">
                                                <% 
                                                  @software_expertise.each_with_index do |value, index|  
                                                %>
                                                    <option value="<%= value[1] %>"><%= value[0] %></option>
                                                <% end %> 
                                            </select>
                                        </div>
                                        
                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <input type="text" name="download[zip_files_attributes][{{$parent.$index}}][software_renderer][{{$index}}][software_version]" id="gallery_zip_software_version_{{$parent.$index}}_{{$index}}" class="form-control from-input" placeholder="Enter Software Version">
                                        </div>

                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <select class="custom-select" name="download[zip_files_attributes][{{$parent.$index}}][software_renderer][{{$index}}][renderer]" id="gallery_zip_renderer_{{$parent.$index}}_{{$index}}">
                                                <% 
                                                  @renderer.each_with_index do |value, index|  
                                                %>
                                                    <option value="<%= value[1] %>"><%= value[0] %></option>
                                                <% end %> 
                                            </select>
                                        </div>

                                        <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                                            <input type="text" name="download[zip_files_attributes][{{$parent.$index}}][software_renderer][{{$index}}][renderer_version]" id="gallery_zip_renderer_version_{{$parent.$index}}_{{$index}}" class="form-control from-input" placeholder="Enter Renderer Version">
                                        </div>
                                    </div>
                                </div>

                                <div class="gallery-select-top clearfix col-md-12 col-sm-12 col-xs-12">
                                    <button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" ng-click="addMoreSoftware($index)" title="Add More Software and Renderer">Add More<span class="fa fa-plus marginL10" aria-hidden="true"></span></button>
                                </div>

                            </div>
                        </div>

                        <div id='output_zip'></div>

                    </div>    

                    <div>
                        <div class="col-md-4 col-sm-6 col-xs-6 marginB10">
                          <div class="checkbox-btn paddinT10">
                            <%= f.check_box :animated, id: 'rc3', name: "download[animated]" %>
                            <!-- <input type="checkbox" value="value-1" id="rc3" name="rc3"/> -->
                            <label for="rc3" onclick>Animated</label>
                          </div>
                        </div>

                        <div class="col-md-4 col-sm-6 col-xs-6 marginB10 padding">
                          <div class="checkbox-btn paddinT10">
                           <%= f.check_box :texture, id: 'rc4', name: "download[texture]" %>
                            <label for="rc4" onclick>Texture</label>
                          </div>
                        </div>

                        <div class="col-md-4 col-sm-6 col-xs-6 marginB10 padding">
                          <div class="checkbox-btn paddinT10">
                           <%= f.check_box :material, id: 'rc5', name: "download[material]" %>
                            <label for="rc5" onclick>Material</label>
                          </div>
                        </div>

                        <div class="col-md-4 col-sm-6 col-xs-6 marginB10">
                          <div class="checkbox-btn paddinT10">
                            <%= f.check_box :lowpoly, id: 'lowpoly', name: "download[lowpoly]" %>
                            <label for="lowpoly" onclick>Lowpoly</label>
                          </div>
                        </div>

                        <div class="col-md-4 col-sm-6 col-xs-6 marginB10 padding">
                          <div class="checkbox-btn paddinT10">
                           <%= f.check_box :rigged, id: 'rc7', name: "download[rigged]" %>
                            <label for="rc7" onclick>Rigged</label>
                          </div>
                        </div>

                        <div class="col-md-4 col-sm-6 col-xs-6 marginB10 padding">
                          <div class="checkbox-btn paddinT10">
                           <%= f.check_box :plugin_used, id: 'rc8', name: "download[plugin_used]" %>
                            <label for="rc8" onclick>Plugin Used</label>
                          </div>
                        </div>

                    </div>

                    <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                      <div class="checkbox-btn paddinT10">
                       <%= f.check_box :uv_mapping, id: 'uv_mapping', name: "download[uv_mapping]" %>
                        <label for="uv_mapping" onclick>UV Mapping</label>
                      </div>
                    </div>

                    <div class="form-group clearfix" id="UnwrappedUVsDiv">
                        <label class="col-md-12 col-sm-12 col-xs-12">Unwrapped UVs</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0">
                            
                        <%= f.select(:unwrapped_uv, options_for_select(Download::UNWRAPPED_UV, params[:download].present? ? params[:download][:unwrapped_uv] : @download[:unwrapped_uv]), {:include_blank => '-- Please Select --'}, {'class' => 'custom-select', 'id' => 'download_unwrapped_uv'})  %>
                        </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Geometry</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0">
                            
                        <%= f.select(:geometry, options_for_select(Download::GEOMETRY, params[:download].present? ? params[:download][:geometry] : @download[:geometry]), {:include_blank => '-- Please Select --'}, {'class' => 'custom-select', 'id' => 'download_geometry'})  %>
                        </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Polygon</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0">
                            <%= f.text_field :polygon, class: 'form-control from-input skill-input', id: 'polygon', placeholder: '', value: params[:download].present? ? params[:download][:polygon] : @download[:polygon] %>
                        </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Vertice</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0">
                            <%= f.text_field :vertice, class: 'form-control from-input skill-input', id: 'vertice', placeholder: '', value: params[:download].present? ? params[:download][:vertice] : @download[:vertice] %>
                        </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Unit</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0">
                            
                        <%= f.select(:unit, options_for_select(Download::UNIT_VALUE, params[:download].present? ? params[:download][:unit] : @download[:unit]), {:include_blank => '-- Please Select --'}, {'class' => 'custom-select', 'id' => 'download_unit'})  %>
                        </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Changelog</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0"> 
                            <%= f.text_area :changelog, class: 'form-control from-input message-form1', id: 'changelog', placeholder: '', :value => params[:download].present? ? params[:download][:changelog] : @download[:changelog] %>
                        </div>
                    </div>

                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">License Type</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0"> 
                            <%= f.select(:license_type, options_for_select(Download::LICENSE_TYPE, params[:download].present? ? params[:download][:license_type] : @download[:license_type]), {:include_blank => '-- Please Select --'}, {'class' => 'custom-select', 'id' => 'download_license_type'})  %>
                        </div>
                    </div>

                    <div class="form-group clearfix" id="LicenseCustomInfoDiv">
                        <label class="col-md-12 col-sm-12 col-xs-12">License Custom Info</label>
                        <div class="col-md-12 col-sm-12 col-xs-12 col-md-offset-0">
                            <%= f.text_area :license_custom_info, class: 'form-control from-input message-form1', id: 'license_custom_info', placeholder: '', :value => params[:download].present? ? params[:download][:license_custom_info] : @download[:license_custom_info] %>
                        </div>
                    </div>
                  
                    <div class="form-group clearfix">
                        <label class="col-md-12 col-sm-12 col-xs-12">Software Used</label>
                        <div class="col-md-12 col-sm-12 col-xs-12">

                        <%= f.select(:software_used, options_for_select(@software_expertise, params[:download].present? ? params[:download][:software_used] : @download[:software_used]), {:include_blank => false}, {'class' => 'form-control multi-select js-chosen-select-multi', 'id' => 'download_software_used', multiple: true})  %>
    
                        </div>
                    </div>

                    <div class="form-group clearfix">
                        <%= f.fields_for :tag do |tag_form| %>
                            <% tag_options = [] 
                            if params[:download].present?
                                tag_options  = params[:download][:tag][:tag]
                                tag_options.reject!{|a| a==""}

                            elsif @download.try(:tags).present?
                                @download.try(:tags).each_with_index do |tag, i|
                                    tag_options[i] = tag['tag']
                                end
                            end
                            %>

                            <label class="col-md-12 col-sm-12 col-xs-12">Tags</label>
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <%= tag_form.select(:tag, options_for_select(tag_options, params[:download].present? ? params[:download][:tag][:tag] : tag_options), {:include_blank => false}, {'class' => 'form-control multi-select js-chosen-select-tags', 'id' => 'tag', multiple: true})  %>
                            </div>
                        <% end %> 

                        <div class="white-txt marginB15 col-md-12 col-sm-12 col-xs-12"><em>Separate tags with commas</em></div>
			            <div class="blue-txt marginB15 col-md-12 col-sm-12 col-xs-12">Choose from the most used tags</div>
			             

			            <% if previous_tags.present? && 'edit' != params[:action] && 'update' != params[:action] %>
			                <div class="col-md-12 col-sm-12 col-xs-12">
			                    <div class="checkbox-btn">
			                        <%= f.check_box :use_tag_from_previous_upload %>
			                        <label for="download_use_tag_from_previous_upload" onclick>Use tags from previous upload </label>
			                    </div>
			                </div>

			            <% end %>


                    </div>


                    



                    <div class="col-md-6 col-sm-6 col-xs-6 marginB10">
                      <div class="checkbox-btn paddinT10">
                       <%= f.check_box :has_adult_content, id: 'has_adult_content', name: "download[has_adult_content]" %>
                        <label for="has_adult_content" onclick>Has Adult Content</label>
                      </div>
                    </div>

                </div>
                <!--<button class="green-btn border-radius" type="button"><i class="fa fa-floppy-o marginR5" aria-hidden="true"></i> Save</button>-->
           
            </div>
          </div>
          
          
        </div>



        <div class="aside col-sm-12 col-xs-12 padding">
                    <div class="panel panel-default">
                        <div class="panel-heading">Publish</div>
                        <div class="panel-body">
                            <div class="clearfix marginB15 row">
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <button type="submit" class="lightbtn" value="SaveDraft" name="commit">Save Draft</button>
                                </div>
                                <% if 'edit' == params[:action] || 'update' == params[:action] %>
                                <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                                    <button onclick = "return preview('<%= @download.paramlink %>')" class="lightbtn" type="button">Preview</button>
                                </div>
                                <% end %>
                            </div>

                            <% if 'edit' == params[:action] || 'update' == params[:action] %>
                                <div class="clearfix marginB15 status-link"> <i class="fa fa-key marginR5 lightcolor" aria-hidden="true"></i> Status : <strong>
                                    <%  if @download.is_trash == 1 %>
                                        Trashed
                                    <%  elsif @download.is_save_to_draft == 1 %>
                                        Draft
                                    <% elsif @download.publish %>
                                        Published
                                    <% else %>
                                        Not Published 
                                    <% end %>    
                                        
                                    </strong>
                                </div>
                            <% end %>
                            
                            <div class="clearfix marginB15 status-link"> <i class="fa fa-eye marginR5 lightcolor" aria-hidden="true"></i> Visibility  : <strong>{{data.selectedOption.name}}</strong> <a href="javascript:void(0);" ng-click="view_visibility_option()" ng-show="show_visibility_edit_option">Edit</a> 
                                <div class="form-group clearfix createpost marginT10" ng-show="show_visibility_option">        
                                    <select id="visibility" name="download[visibility]" class="custom-select" ng-options="option.name for option in data.availableOptions track by option.id" ng-model="data.selectedOption" ng-change="view_visibility_edit_option()"></select>
                                </div>
                            </div>

                            <div class="clearfix marginB15 status-link"> 
                                <i class="fa fa-calendar marginR5 lightcolor" aria-hidden="true"></i> Publish : <strong>{{dataPublish.selectedOption.name}}</strong> <a href="javascript:void(0);" ng-click="view_publish_option()" ng-show="show_publish_edit_option">Edit</a> 


                                <div class='form-group clearfix marginT10' ng-show="show_publish_option">
                                    <div class='clearfix' >
                                        <select id="publish" name="download[publish]" class="custom-select" ng-options="option.name for option in dataPublish.availableOptions track by option.id" ng-model="dataPublish.selectedOption" ng-change="update_publish_type()"></select>
                                    </div>
                                      <div class='clearfix input-group date marginT10 right-panel-datetime-picker' id='datetimepicker1' ng-show="show_schedule_time" >
                                        <%= f.text_field :schedule_time, class: 'form-control from-input', id: 'schedule_time', placeholder: '', "ng-model" => "ctrl.schedule_time.date", "is-open" => "ctrl.schedule_time.open", "datetime-picker" => "yyyy-MM-dd HH:mm", 'readonly' => 'readonly' %>
                                        <span class="input-group-addon" ng-click="ctrl.openCalendar($event, 'schedule_time')"> <span class="glyphicon glyphicon-calendar"></span> </span>
                                    </div>      
                                                         
                                </div>


                            </div>
                            <div class="clearfix row">

                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <% if 'edit' == params[:action] %>
                                        <%= link_to 'Delete'.html_safe, trash_download_path(@download.paramlink), data: { confirm: 'Are you sure?' }, title: "Delete", class: "btn-link" %>
                                    <% end %>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6 text-right">
                                 <button type="submit" class="green-btn" value="Publish" name="commit">Publish</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">Product Thumbnail</div>
                        <div class="panel-body padding">
                            <div class="marginB15 pos-rel img-company-logo">

                                <%= f.file_field(:company_logo, accept: "image/*", id: "companyLogoUpload", "ng-model" => "companyLogoUpload", onchange: "angular.element(this).scope().imageUpload(this)", class: "drag-photo") %>

                                <center>
                                    <img id='companylogoimage' src="/assets/database/jobs-logo.png" alt="img" class="img-responsive" ng-src="{{companyLogoImage}}">
                                </center>

                            </div>
                             <!--  <div id='crop_container'></div>   -->
                           <% for attribute in [:zoom_w, :zoom_h, :zoom_x, :zoom_y, :drag_x, :drag_y, :rotation_angle, :crop_x, :crop_y, :crop_w, :crop_h] %>
                                <%= f.hidden_field attribute, :id => attribute %>
                            <% end %>  
                            <div class="clearfix marginB15 text-center project-btn">
                               <!--  <div class="lightbtn"><i class="fa fa-crop marginR5 blue-txt" aria-hidden="true"></i> Crop</div> -->
                               <button id="cropbutton" type="button" class="lightbtn hidden" data-target="#modal_crop" data-toggle="modal"> <i class="fa fa-crop marginR5 blue-txt" aria-hidden="true"></i> Crop</button>

                                <div class="lightbtn" ng-click="clickCompanyLogoUpload()"><i class="fa fa-upload marginR5 blue-txt" aria-hidden="true"></i> Upload</div>
                                <%#= f.file_field(:company_logo, accept: "image/*", id: "companyLogoUpload", "ng-model" => "companyLogoUpload", onchange: "angular.element(this).scope().imageUpload(this)", style: "display: none;")%>


                                <div id="remove-custom-thumb" class="lightbtn hidden" ng-click="removeCompanyLogo()"><i class="fa fa-times marginR5 blue-txt" aria-hidden="true"></i> Remove custom thumbnail</div>
                            </div>
                            <div class="lightcolor txt12 marginB15 text-center">Drag and drop an image above to replace</div>

                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">Visibility</div>
                        <div class="panel-body">
                            <div class="white-txt marginB15"> Where do you want this Project to show?</div>
                            <div class="checkbox-btn marginB15">
                                <%= f.check_box :show_on_cgmeetup , name: 'download[show_on_cgmeetup]', id: 'gallery_show_on_cgmeetup' %>
                                <label for="gallery_show_on_cgmeetup" onclick>CGMeetup.net</label>
                            </div>
                            <div class="checkbox-btn">
                                <%= f.check_box :show_on_website , name: 'download[show_on_website]', id: 'gallery_show_on_website' %>
                                <label for="gallery_show_on_website" onclick>My Website</label>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="panel panel-default">
                        <div class="panel-heading">Albums</div>
                        <div class="panel-body"> </div>
                    </div> -->
                </div>




        <% end %> 
      </section>
            <div class="modal fade default-popup" id="add-video-popup" role="dialog">
                <div class="modal-dialog"> 

                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" id="close-btn-add-video-popup"></button>
                            <h4 class="modal-title text-uppercase">Add Video</h4>
                        </div>

                        <div class="modal-body"> 
                            <form id='test' action="javascript:void(0);" ng-submit="getVideoDetailFromURL()">   
                                <div class="col-md-12 add-video-alert err-msg padding text-center">{{addVideoErr}}</div>  
                                <div class="form-group clearfix">
                                    <label>Paste a Vimeo or YouTube video URL here</label>
                                    <input type="url" placeholder="Video URL" value="" ng-model="videoURL" id="videoURL" class="form-control from-input" />
                                    <button type="submit" ng-show="false">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div  class="modal fade default-popup" id="modal_crop" aria-labelledby="modalLabel" role="dialog" tabindex="-1">
              <div class="modal-dialog" role="document">
                <div class="modal-content">

                  <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal"></button>
                    <h5 class="modal-title" id="modalLabel">Crop the image</h5>
                  
                  </div>
                  <div class="modal-body">
                    <div>
                        <img id="cropimage" src="" alt="Picture">
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default lightbtn" data-dismiss="modal">Crop</button>
                  </div>
                </div>
              </div>
            </div>

             <div class="modal fade default-popup" id="add-sketchfab-popup" role="dialog">
                <div class="modal-dialog"> 

                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" id="close-btn-add-sketchfab-popup"></button>
                            <h4 class="modal-title text-uppercase">Add Sketchfab ED Model</h4>
                        </div>

                        <div class="modal-body"> 
                            <form id='test' action="javascript:void(0);" ng-submit="getSketchfabDetailFromURL()">   
                                <input ng-model="sketchfabThumbnail" id="sketchfabThumbnail" value="" type="hidden" />
                                <div class="col-md-12 add-sketchfab-alert err-msg padding text-center">{{addSketchfabErr}}</div>  
                                <div class="form-group clearfix">
                                    <label>Paste a <a href="http://www.sketchfab.com" target="_blank">Sketchfab</a> URL here</label>
                                    <input type="url" placeholder="Sketchfab URL" value="" ng-model="sketchfabURL" id="sketchfabURL" class="form-control from-input" />

                                    <button type="submit" ng-show="false">Submit</button>
                                </div>
                                <div class="clearfix" id="sketchfabView">
                                </div>
                                <input type="text" placeholder="Enter Caption" ng-model="caption_sketchfeb" value=""  id="caption_sketchfeb" class="hidden form-control from-input" /> 
                            </form>
                        </div>

                        <div class="modal-footer hidden" id="footerSketchfabPopup">
                            <button type="button" class="btn btn-default lightbtn" ng-click="addSketchfabURL()">Add Model</button>
                        </div>

                    </div>
                </div>
            </div>


    </div>
  </div>

</section>
</div>
</div>

<script type="text/javascript">
    
    function preview(paramlink){
      window.location.href = '<%= root_url %>downloads/' + paramlink + '/show';
    }


    // main page angular app start
    var app = angular.module('New_Download', ["angularLazyImg", 'ui.bootstrap','MainModule', 'ui.bootstrap.datetimepicker']);

    app.controller('NewDownloadCtrl', function($scope, $http) {

        var that = this;

        //profile pic upload
        $scope.clickCompanyLogoUpload = function(){
          angular.element('#companyLogoUpload').trigger('click');
        };

        $scope.companyLogoImage = '';
        <% if @download.try(:company_logo).try(:large_image).try(:url).present? %>
            $scope.companyLogoImage = "<%= @download.company_logo.large_image.url %>";
        <% end %>    

        $scope.imageUpload = function(element){

            var reader = new FileReader();
            reader.onload = $scope.imageIsLoaded;

            reader.readAsDataURL(element.files[0]);
        }

        $scope.imageIsLoaded = function(e){
            $scope.$apply(function() {

                $scope.companyLogoImage= e.target.result;
                angular.element('#crop_w').val('');
                angular.element('#crop_h').val('');
                angular.element('#crop_x').val('');
                angular.element('#crop_y').val('');
                angular.element('#zoom_w').val('');
                angular.element('#zoom_h').val('');
                angular.element('#zoom_x').val('');
                angular.element('#zoom_y').val('');
                angular.element( document.querySelector( '#cropbutton' ) ).removeClass('hidden');
                angular.element( document.querySelector( '#remove-custom-thumb' ) ).removeClass('hidden');

            });
        }

        $scope.removeCompanyLogo = function(e){
            $scope.companyLogoImage= "/assets/database/jobs-logo.png";
            angular.element('#companyLogoUpload').val(null);
            angular.element('#crop_w').val('');
            angular.element('#crop_h').val('');
            angular.element('#crop_x').val('');
            angular.element('#crop_y').val('');
            angular.element('#zoom_w').val('');
            angular.element('#zoom_h').val('');
            angular.element('#zoom_x').val('');
            angular.element('#zoom_y').val('');
            angular.element( document.querySelector( '#cropbutton' ) ).addClass('hidden');
            angular.element( document.querySelector( '#remove-custom-thumb' ) ).addClass('hidden');
        }

        visibility_sel_id = '0';
        visibility_sel_name = 'Public';

        publish_sel_id = '1';
        publish_sel_name = 'Immediately';

        $scope.show_visibility_option = false;
        $scope.show_visibility_edit_option = true;
        $scope.show_schedule_time = false;
        $scope.show_publish_option = false;
        $scope.show_publish_edit_option = true;

        this.schedule_time = {
            date: new Date()
          
        };
        
        <% if params['download'].present? %>

            <% if params['download']['visibility'] == '1' %>
                visibility_sel_id = '1';
                visibility_sel_name = 'Private';

            <% end %>

            <% if params['download']['publish'] == '0' %>
                publish_sel_id = '0';
                publish_sel_name = 'Schedule';

                $scope.show_publish_option = true;
                $scope.show_publish_edit_option = false;
                $scope.show_schedule_time = true;

                <% if params['download']['schedule_time'] != '' %>
                    var schedule_time_val = '<%= params['download']['schedule_time'] %>';
                    this.schedule_time = {
                        date: new Date(schedule_time_val)
                    };
                <% else %>
                    this.schedule_time = {
                    };   
                <% end %>
            <% end %>

        <% elsif 'edit' == params[:action] || 'update' == params[:action] %>
                <% if @download.visibility == 1 %>
                    visibility_sel_id = '1';
                    visibility_sel_name = 'Private'; 
                <% end %>

                <% if @download.publish == 0 %>
                    publish_sel_id = '0';
                    publish_sel_name = 'Schedule';

                    $scope.show_publish_option = true;
                    $scope.show_publish_edit_option = false;
                    $scope.show_schedule_time = true;

                    <% if @download.schedule_time != '' %>
                        var schedule_time_val = '<%= @download.schedule_time %>';
                        this.schedule_time = {
                            date: new Date(schedule_time_val)
                        };
                    <% else %>
                        this.schedule_time = {
                        };   
                    <% end %>
                <% end %>


        <% end %>

        $scope.data = {
            availableOptions: [
                {id: '0', name: 'Public'},
                {id: '1', name: 'Private'}
            ],
            selectedOption: {id: visibility_sel_id, name: visibility_sel_name} //This sets the default value of the select in the ui
        };

        $scope.view_visibility_option = function(){
            $scope.show_visibility_option = true;
            $scope.show_visibility_edit_option = false;
        } 
       
        $scope.view_visibility_edit_option = function(){
            $scope.show_visibility_option = false;
            $scope.show_visibility_edit_option = true;
        }


        $scope.dataPublish = {
            availableOptions: [
                {id: '1', name: 'Immediately'},
                {id: '0', name: 'Schedule'}
            ],
            selectedOption: {id: publish_sel_id, name: publish_sel_name} //This sets the default value of the select in the ui
        };

        $scope.view_publish_option = function(){
            $scope.show_publish_option = true;
            $scope.show_publish_edit_option = false;
        } 
       
        $scope.update_publish_type = function(){
            
            if ($scope.dataPublish.selectedOption.id == 0){
                $scope.show_schedule_time = true;
            }else{
                $scope.show_schedule_time = false;    
            }

        }

        this.openCalendar = function(e, picker) {

            that[picker].open = true;
        };

/***** for edit page section start*******/
        $scope.renderer_options = <%= @renderer.to_json.html_safe %>;
        $scope.software_expertise_options = <%= @software_expertise.to_json.html_safe %>;

         //To get saved zip and update them
        $scope.add_zip_default = <%= @download.zip_files.to_json.html_safe %>;
        $scope.removeZipDefault = function (x, id) {   
            var removedid = angular.element('#gallery_removedzip').attr('value');

            if(removedid == ''){
                removedid = id;
            }else{
                removedid = removedid + ',' +id;
            }

            angular.element('#gallery_removedzip').attr('value', removedid);

            angular.element( document.querySelector( '#lizipdefault' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#lizipdefault' + x ) ).html('');
        }


        //To get saved images and update them
        $scope.add_images_default = <%= @download.images.to_json.html_safe %>;
        $scope.removeImageDefault = function (x, id) {   
            var removedid = angular.element('#gallery_removedimages').attr('value');

            if(removedid == ''){
                removedid = id;
            }else{
                removedid = removedid + ',' +id;
            }

            angular.element('#gallery_removedimages').attr('value', removedid);

            angular.element( document.querySelector( '#lidefault' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#lidefault' + x ) ).html('');
        }


        //To get saved video_url and update them
        $scope.add_video_url_default = <%= @download.videos.to_json.html_safe %>;
        $scope.removeVideoURLDefault = function (x, id) {   
            var removedid = angular.element('#gallery_removedvideourl').attr('value');

            if(removedid == ''){
                removedid = id;
            }else{
                removedid = removedid + ',' +id;
            }

            angular.element('#gallery_removedvideourl').attr('value', removedid);

            angular.element( document.querySelector( '#livideourldefault' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#livideourldefault' + x ) ).html('');
        }

        angular.forEach($scope.add_video_url_default, function(value, key) {
            
            url = '/get_video_detail_from_url?url=' + value['video'];

            $http.get(url)
            .then(function(response) {
                angular.element( document.querySelector( '#gallery_video_url_image_view_default_' + key ) ).attr('src', response.data.thumbnail);
            })
            .catch(function(response) {
            })
            .finally(function() {
                
            });
        });

        //To get saved sketchfab and update them
        $scope.add_sketchfab_url_default = <%= @download.sketchfebs.to_json.html_safe %>;
        $scope.removeSketchfabURLDefault = function (x, id) {   
            var removedid = angular.element('#gallery_removedsketchfab').attr('value');

            if(removedid == ''){
                removedid = id;
            }else{
                removedid = removedid + ',' +id;
            }

            angular.element('#gallery_removedsketchfab').attr('value', removedid);

            angular.element( document.querySelector( '#lisketchfaburldefault' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#lisketchfaburldefault' + x ) ).html('');
        }

        angular.forEach($scope.add_sketchfab_url_default, function(value, key) {
            
            url = 'https://sketchfab.com/oembed?url=' + value['sketchfeb'] + '&maxwidth=568&dataType=jsonp';

            $http.get(url)
            .then(function(response) {       
                angular.element( document.querySelector( '#gallery_sketchfab_url_image_view_default_' + key ) ).attr('src', response.data.thumbnail_url);               
            })
            .catch(function(response) {
            })
            .finally(function() {
                
            });
        });

        //To get saved upload video and update them
        $scope.add_upload_videos_default = <%= @download.upload_videos.to_json.html_safe %>;
        $scope.removeUploadVideoDefault = function (x, id) {   
            var removedid = angular.element('#gallery_removedUploadVideo').attr('value');

            if(removedid == ''){
                removedid = id;
            }else{
                removedid = removedid + ',' +id;
            }

            angular.element('#gallery_removedUploadVideo').attr('value', removedid);

            angular.element( document.querySelector( '#liuploadvideodefault' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#liuploadvideodefault' + x ) ).html('');
        }

        angular.forEach($scope.add_upload_videos_default, function(value, key) {

            url = '/get_upload_video_thumbnail?url=' + value['uploadvideo']['url'];

            $http.get(url)
            .then(function(response) {       
                angular.element( document.querySelector( '#gallery_upload_video_view_default_' + key ) ).attr('src', response.data.thumbnail);               
            })
            .catch(function(response) {
            })
            .finally(function() {
                
            });
        });

        //To get saved marmoset and update them
        $scope.add_marmo_sets_default = <%= @download.marmo_sets.to_json.html_safe %>;
        $scope.removeMarmoSetDefault = function (x, id) {   
            var removedid = angular.element('#gallery_removedMarmoset').attr('value');

            if(removedid == ''){
                removedid = id;
            }else{
                removedid = removedid + ',' +id;
            }

            angular.element('#gallery_removedMarmoset').attr('value', removedid);

            angular.element( document.querySelector( '#limarmosetdefault' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#limarmosetdefault' + x ) ).html('');
        }



/*********for edit page section end***************/

    
    /********* add new zip ***************/
        var add_zip_count = 0;
        $scope.add_zip = [];
        $scope.zip_software_count = [];

        
        console.log($scope.add_zip);

        $scope.addNewZip = function () {
            $scope.add_zip.push(add_zip_count);

            add_zip_count++;

            setTimeout(function() {

               add_zip_count_test = add_zip_count - 1; 
               angular.element('#gallery_zip_image_' + add_zip_count_test).trigger('click');
               
            }, 200);

        }

        $scope.removeZip = function (x) {   
            //angular.element( document.querySelectorAll( '#gallery_image_caption_image_' + x ) ).remove();
            //angular.element( document.querySelectorAll( '#gallery_image_image_' + x ) ).remove();
            angular.element( document.querySelector( '#lizip' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#lizip' + x ) ).html('');
            //$scope.add_images.splice(x, 1);
        }

        $scope.newZipUpload = function(element){

            $scope.$apply(function() {
                add_zip_count_test = add_zip_count - 1;
                angular.element( document.querySelector( '#gallery_zip_view_' + add_zip_count_test ) ).html(element.files.item(0).name);
                angular.element( document.querySelector( '#lizip' + add_zip_count_test ) ).removeClass('hidden');

                $scope.zip_software_count[add_zip_count_test] = [0];
                //$scope.zip_software_count[add_zip_count_test].push(0);
                //debugger;

                angular.element('#gallery_zip_software_count_' + add_zip_count_test).attr('value', software_count);

            });

        }

        $scope.addMoreSoftware = function (parent_key) {
            
            var arr_len = $scope.zip_software_count[parent_key].length;

            new_child_val = 0;
            if (arr_len > 0){
                arr_len = arr_len - 1;
                var val = $scope.zip_software_count[parent_key][arr_len];
                new_child_val = val + 1;
            }

            $scope.zip_software_count[parent_key].push(new_child_val);

        }

        $scope.addMoreSoftwareDefault = function (parent_key) {
            
            var arr_len = $scope.add_zip_default[parent_key]['software'].length;

            new_child_val = arr_len + 1;
            
            $scope.add_zip_default[parent_key]['software'].push(new_child_val);

        }

        $scope.removeSoftware = function (parent_key, child_key) {
            angular.element( document.querySelector( '#lizip_child' + parent_key + '_' + child_key) ).html('');            
        }

        $scope.removeSoftwareDefault = function (parent_key, child_key) {
            angular.element( document.querySelector( '#lizip_child_default' + parent_key + '_' + child_key) ).html('');            
        }

      

/********* add new images ***************/
        var add_images_count = 0;
        $scope.add_images = [];
        
        console.log($scope.add_images);

        $scope.addNewImages = function () {
            $scope.add_images.push(add_images_count);

            add_images_count++;

            setTimeout(function() {

               add_images_count_test = add_images_count - 1; 
               angular.element('#gallery_image_image_' + add_images_count_test).trigger('click');
               
            }, 200);

        }

        $scope.removeImage = function (x) {   
            //angular.element( document.querySelectorAll( '#gallery_image_caption_image_' + x ) ).remove();
            //angular.element( document.querySelectorAll( '#gallery_image_image_' + x ) ).remove();
            angular.element( document.querySelector( '#li' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#li' + x ) ).html('');
            //$scope.add_images.splice(x, 1);
        }

        $scope.newImageUpload = function(element){
            var reader = new FileReader();
            reader.onload = $scope.newImageIsLoaded;
            reader.readAsDataURL(element.files[0]);
        }

        $scope.newImageIsLoaded = function(e){
            $scope.$apply(function() {
                add_images_count_test = add_images_count - 1;
                angular.element( document.querySelector( '#gallery_image_view_' + add_images_count_test ) ).attr('src', e.target.result);
                angular.element( document.querySelector( '#li' + add_images_count_test ) ).removeClass('hidden');
            });
        }

        /***************Add Video from url ****************/


        var add_video_url_count = 0;
        $scope.add_video_url = [];

        $scope.addVideoURL = function (response) {
            $scope.add_video_url.push(add_video_url_count);
            add_video_url_count++;

            setTimeout(function() {

               add_video_url_count_test = add_video_url_count - 1; 
               angular.element( document.querySelector( '#gallery_video_url_image_view_' + add_video_url_count_test ) ).attr('src', response.data.thumbnail);
               angular.element('#gallery_videos_video_' + add_video_url_count_test).attr('value', $scope.videoURL);
               angular.element('#gallery_videos_caption_video_' + add_video_url_count_test).html(response.data.title);

               angular.element('#close-btn-add-video-popup').trigger('click');
               
            }, 200);
        }

        $scope.removeVideoURL = function (x) {
            angular.element( document.querySelector( '#livideourl' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#livideourl' + x ) ).html('');
            //$scope.add_video_url.splice(x, 1);
        }


        $scope.getVideoDetailFromURL = function() {

            url = '/get_video_detail_from_url?url=' + $scope.videoURL;

            $scope.addVideoErr = '';
            $http.get(url)
            .then(function(response) {
                /*alert(response.data.title);
                alert(response.data.thumbnail);
                console.log(response);*/
                $scope.addVideoURL(response);
                //$scope.download_data = response.data;
            })
            .catch(function(response) {
                $scope.addVideoErr = 'Invalid Url';
            })
            .finally(function() {
                
            });
        };

/***************Add sketchfab from url ****************/


        var add_sketchfab_url_count = 0;
        $scope.add_sketchfab_url = [];

        $scope.addSketchfabURL = function () {
            //console.log(response.data.title);
            $scope.add_sketchfab_url.push(add_sketchfab_url_count);
            add_sketchfab_url_count++;


            setTimeout(function() {
               add_sketchfab_url_count_test = add_sketchfab_url_count - 1; 

               sketchfabThumbnailuRL = angular.element('#sketchfabThumbnail').val();
               sketchfabCaption = angular.element('#caption_sketchfeb').val();

               angular.element( document.querySelector( '#gallery_sketchfab_url_image_view_' + add_sketchfab_url_count_test ) ).attr('src', sketchfabThumbnailuRL);
               angular.element('#gallery_sketchfebs_sketchfeb_' + add_sketchfab_url_count_test).attr('value', $scope.sketchfabURL);
               
               angular.element('#gallery_sketchfebs_caption_sketchfeb_' + add_sketchfab_url_count_test).val(sketchfabCaption);

               angular.element('#close-btn-add-sketchfab-popup').trigger('click');
               
            }, 200);
        }

        $scope.removeSketchfabURL = function (x) {
            angular.element( document.querySelector( '#lisketchfaburl' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#lisketchfaburl' + x ) ).html('');
            //$scope.add_video_url.splice(x, 1);
        }


        $scope.getSketchfabDetailFromURL = function() {

            url = 'https://sketchfab.com/oembed?url=' + $scope.sketchfabURL + '&maxwidth=568&dataType=jsonp';

            $scope.addSketchfabErr = '';
            $http.get(url)
            .then(function(response) {
                //alert(response.data.title);
               // alert(response.data.thumbnail);
               // console.log(response);

//console.log(response.data.thumbnail_url);

                angular.element( document.querySelector( '#sketchfabView') ).html(response.data.html);
               
                angular.element('#sketchfabThumbnail').val(response.data.thumbnail_url);

                
                angular.element( document.querySelector( '#footerSketchfabPopup') ).removeClass('hidden');
                angular.element( document.querySelector( '#caption_sketchfeb') ).removeClass('hidden');

                angular.element( document.querySelector( '#caption_sketchfeb') ).val(response.data.title);

                // angular.element('#caption_sketchfab').val(response.data.title);

             //   angular.element( document.querySelector( '#caption_sketchfeb') ).removeClass('hidden');

                //$scope.addSketchfabURL(response);

                //$scope.download_data = response.data;
            })
            .catch(function(response) {
                $scope.addSketchfabErr = 'Invalid Url';
            })
            .finally(function() {
                
            });
        };

  /********* add Marmoset ***************/

        var add_marmo_set_count = 0;
        $scope.add_marmo_sets = [];

        $scope.addNewMarmoSets = function (response) {
            $scope.add_marmo_sets.push(add_marmo_set_count);

            add_marmo_set_count++;

            setTimeout(function() {

               add_marmo_set_count_test = add_marmo_set_count - 1; 
               angular.element('#gallery_marmo_sets_marmoset_' + add_marmo_set_count_test).trigger('click');
               angular.element('#gallery_marmo_sets_caption_marmoset_' + add_marmo_set_count_test).html(response.data.title);
               
            }, 200);

        }

        $scope.removeMarmoSet = function (x) {  
            angular.element( document.querySelector( '#limarmoset' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#limarmoset' + x ) ).html('');
            //$scope.add_marmo_sets.splice(x, 1);
        }

        $scope.newMarmoSet = function(element){
        
            var reader = new FileReader();
            reader.onload = $scope.newMarmoSetIsLoaded;
            reader.readAsDataURL(element.files[0]);
        }

        $scope.newMarmoSetIsLoaded = function(e){
            $scope.$apply(function() {
                add_marmo_set_count_test = add_marmo_set_count - 1;
                angular.element( document.querySelector( '#gallery_marmo_set_view_' + add_marmo_set_count_test ) ).attr('src', e.target.result);
                angular.element( document.querySelector( '#limarmoset' + add_marmo_set_count_test ) ).removeClass('hidden');
            });
        }

/********* add upload video ***************/

        var add_upload_video_count = 0;
        $scope.add_upload_videos = [];

        $scope.addNewUploadVideos = function () {
            $scope.add_upload_videos.push(add_upload_video_count);

            add_upload_video_count++;

            setTimeout(function() {

               add_upload_video_count_test = add_upload_video_count - 1; 
               angular.element('#gallery_upload_videos_uploadvideo_' + add_upload_video_count_test).trigger('click');
               
            }, 200);

        }

        $scope.removeUploadVideo = function (x) {  
            angular.element( document.querySelector( '#liuploadvideo' + x ) ).addClass('hidden');
            angular.element( document.querySelector( '#liuploadvideo' + x ) ).html('');
            //$scope.add_upload_videos.splice(x, 1);
        }

        $scope.newVideoUpload = function(element){
            var reader = new FileReader();
            reader.onload = $scope.newUploadVideoIsLoaded;
            reader.readAsDataURL(element.files[0]);
        }

        $scope.newUploadVideoIsLoaded = function(e){
            $scope.$apply(function() {
                add_upload_video_count_test = add_upload_video_count - 1;
                angular.element( document.querySelector( '#gallery_upload_video_view_' + add_upload_video_count_test ) ).attr('src', e.target.result);
                angular.element( document.querySelector( '#liuploadvideo' + add_upload_video_count_test ) ).removeClass('hidden');
            });
        }
        
    });
   angular.bootstrap(document.getElementById("New_Download"), ['New_Download']);

    $(document).ready(function(){

        $('#add-video-popup').on('hidden.bs.modal', function () {
            $('#videoURL').val('');
        })

        $('#add-sketchfab-popup').on('hidden.bs.modal', function () {
            $('#sketchfabURL').val('');
            $('#sketchfabThumbnail').val('');
            $('#sketchfabView').html('');
            $('#footerSketchfabPopup').addClass('hidden');
        })

/*****************Crop image code**********************/
     var flag = 0;
        $('#companylogoimage').on('load',function(){ 
             $('#cropimage').attr('src',$('#companylogoimage').attr('src'));
             var $image = $('#cropimage').attr('src');

              var cropBoxData;
              var canvasData;

              $('#modal_crop').on('shown.bs.modal', function () {
                    $('#cropimage').cropper({
                          autoCropArea: 0.5,
                          ready: function () {
                                $('#cropimage').cropper('setCanvasData', canvasData);
                                $('#cropimage').cropper('setCropBoxData', cropBoxData);
                            }
                    });
              }).on('hidden.bs.modal', function () {
                    
                    cropBoxData = $('#cropimage').cropper('getCropBoxData');
                    canvasData  = $('#cropimage').cropper('getCanvasData');

                    var crop_w = '';   
                    var crop_h = '';   
                    var crop_x = '';   
                    var crop_y = '';   
                    var zoom_w = '';   
                    var zoom_h = '';   
                    var zoom_x = '';   
                    var zoom_y = '';   

                    if(flag == 0){
                        
                        zoom_w = canvasData.width;   
                        zoom_h = canvasData.height;   
                        zoom_x = canvasData.left;   
                        zoom_y = canvasData.top;  
                        crop_w = cropBoxData.width;   
                        crop_h = cropBoxData.height;   
                        crop_x = cropBoxData.left;   
                        crop_y = cropBoxData.top;  

                        $('#crop_w').val(crop_w);
                        $('#crop_h').val(crop_h);
                        $('#crop_x').val(crop_x);
                        $('#crop_y').val(crop_y);
                        $('#zoom_w').val(zoom_w);
                        $('#zoom_h').val(zoom_h);
                        $('#zoom_x').val(zoom_x);
                        $('#zoom_y').val(zoom_y);    

                    }   

                    flag = 1;
                    $('#cropimage').cropper('destroy');
                });
        });

<% post_type_id_arr = []
   post_type_category_id_arr = [] 
   sub_category_id_arr = [] 
if params[:download].present?

    post_type_id_arr = params[:download][:post_type_id]
    post_type_category_id_arr = params[:download][:post_type_category_id]
    sub_category_id_arr = params[:download][:sub_category_id]

elsif params[:action] == 'edit'

    post_type_id_arr = @download[:post_type_id]
    post_type_category_id_arr = @download[:post_type_category_id]
    sub_category_id_arr = @download[:sub_category_id]

end 
    if !post_type_id_arr.nil?
        post_type_id_arr.reject!{|a| a==""}
    end
    if !post_type_category_id_arr.nil?
        post_type_category_id_arr.reject!{|a| a==""}
    end
    if !sub_category_id_arr.nil?
        sub_category_id_arr.reject!{|a| a==""}
    end
%>

    var post_type_id_arr = <%= post_type_id_arr.to_json.html_safe %>;
    var post_type_category_id_arr = <%= post_type_category_id_arr.to_json.html_safe %>;
    var sub_category_id_arr = <%= sub_category_id_arr.to_json.html_safe %>;

    get_post_type_category_list(post_type_id_arr, post_type_category_id_arr);
    get_sub_category_list(post_type_category_id_arr, sub_category_id_arr);


    $('#post_type_id').on('change',function(){
        post_type_id = $(this).val();
        get_post_type_category_list(post_type_id, []);
        $("select#sub_category_id").html('');
    });

    $('#post_type_category_id').on('change',function(){
        post_type_category_id = $(this).val();
        get_sub_category_list(post_type_category_id, []);
    }); 

    function get_post_type_category_list(post_type_id, selected_val){

        if (post_type_id !== null && post_type_id != ''){
            $.ajax({
                type: "GET",
                url: "/downloads/get_post_type_category_list",
                data:{post_type_id:post_type_id},
                success: function(data){
                    var options = '';
                      for (var i = 0; i < data.length; i++) {

                        var selected = '';
                        
                        if ($.inArray(data[i]['id'].toString(),selected_val) != -1){    
                            selected = 'selected="selected"';
                        }

                        options += '<option value="' + data[i]['id'] + '" ' + selected + '>' + data[i]['name'] + '</option>';
                      }
                    
                 $("select#post_type_category_id").html(options);
                }
            });
        }else{
            $("select#post_type_category_id").html('');
        } 
    }

    function get_sub_category_list(post_type_category_id, selected_val){
        
        if (post_type_category_id !== null && post_type_category_id != ''){
            $.ajax({
                type: "GET",
                url: "/downloads/get_post_type_category_list",
                data:{parent_id:post_type_category_id},
                success: function(data){
                    var options = '';
                      for (var i = 0; i < data.length; i++) {

                        var selected = '';
                        if ($.inArray(data[i]['id'].toString(), selected_val) != -1){ 
                            selected = 'selected="selected"';
                        }

                        options += '<option value="' + data[i]['id'] + '" ' + selected + '>' + data[i]['name'] + '</option>';
                      }
                    
                 $("select#sub_category_id").html(options);
                }
            });
        }else{
            $("select#sub_category_id").html('');
        }
    }

    $("#gallery_image_image_999").on('change',function(){
       $('#gallery_removedids').val('');
       var outputhtml  =   '';  
       var j = 999;    
       var k = 0;    

        for(i=0; i< this.files.length; i++){
             
            reader = new FileReader();  
            reader.readAsDataURL(this.files[i]);
            var ext = this.files[i].name.split('.').pop().toLowerCase();
            if($.inArray(ext, ['gif','png','jpg','jpeg','tif','tiff','bmp']) == -1) {
                alert('Please choose valid image only.');
                return false;
            }
           reader.onload = function(event){
                outputhtml  +=   '<li class="clearfix col-md-3 col-sm-3 col-xs-6 marginB15" id="li'+j+'"><div class="galleryselect clearfix"><div class="gallery-select-top clearfix"> <span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span> <span class="pull-right"><a  href="javascript:void(0);" onclick="removethumb('+j+','+k+')" id="remove_'+j+'" class="fa fa-times" aria-hidden="true"></a></span> </div><center><img src="'+event.target.result+'" alt="img" class="img-responsive img-preview" id="gallery_image_view_'+j+'" ></center><div class="clearfix padding10"><textarea class="form-control reel-txt" name="download[avatar_caption][][caption_image]" id="gallery_image_caption_image_'+j+'" placeholder="Enter caption"></textarea></div></div></li>';
                
                j = j +1;
                k = k +1;
            };
         }   
       
        setTimeout(function() {
            $('#output').html(outputhtml);
        }, 500); 
             
    });

    $("#gallery_zip_image_999").on('change',function(){
       $('#gallery_removedzip_new').val('');
       var outputhtml  =   '';  
       var j = 999;    
       var k = 0;    
       var l = 0;    

       var file_name = new Array(); 

        for(i=0; i< this.files.length; i++){
             
            reader = new FileReader();  
            reader.readAsDataURL(this.files[i]);
            file_name[i] = this.files[i].name;

            var ext = this.files[i].name.split('.').pop().toLowerCase();
            if($.inArray(ext, ['zip','rar']) == -1) {
                alert('Please choose valid zip or rar only.');
                return false;
            }
            reader.onload = function(event){
                
                outputhtml  +=   '<div id="lizip'+j+'" class="col-md-12 col-sm-12 col-xs-12 marginB10"><div class="galleryselect clearfix"><div class="gallery-select-top clearfix"><span class="pull-left"><i class="fa fa-upload" aria-hidden="true"></i></span><span class="pull-left marginL10" id="gallery_zip_view_'+j+'">'+file_name[k]+'</span><button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" onclick="removezip('+j+','+k+')" title="Remove Zip File">Remove Zip File<span class="fa fa-times marginL10" aria-hidden="true"></span></button></div><div class="clearfix padding10"><textarea class="form-control reel-txt" name="download[zip_caption][][zip_caption]" id="gallery_zip_caption_image_'+j+'" placeholder="Enter caption"></textarea></div><div id="softwareRendererDiv'+k+'"><div id="lizip_child'+j+'_'+l+'"><div class="form-group clearfix marginB10"><div class="gallery-select-top clearfix"><button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" onclick="removeSoftwareRenderer('+j+', '+l+')" title="Remove Software and Renderer">Remove<span class="fa fa-times marginL10" aria-hidden="true"></span></button></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><select class="custom-select" name="download[software_renderer]['+k+']['+l+'][software]" id="gallery_zip_software_used_'+j+'_'+l+'"><% @software_expertise.each_with_index do |value, index| %><option value="<%= value[1] %>"><%= value[0] %></option><% end %></select></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><input type="text" name="download[software_renderer]['+k+']['+l+'][software_version]" id="gallery_zip_software_version_'+j+'_'+l+'" class="form-control from-input" placeholder="Enter Software Version"></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><select class="custom-select" name="download[software_renderer]['+k+']['+l+'][renderer]" id="gallery_zip_renderer_'+j+'_'+l+'"><% @renderer.each_with_index do |value, index| %><option value="<%= value[1] %>"><%= value[0] %></option><% end %></select></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><input type="text" name="download[software_renderer]['+k+']['+l+'][renderer_version]" id="gallery_zip_renderer_version_'+j+'_'+l+'" class="form-control from-input" placeholder="Enter Renderer Version"></div></div></div></div><div class="gallery-select-top clearfix col-md-12 col-sm-12 col-xs-12"><button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" onclick="addMoreSoftwareRenderer('+j+','+k+')" title="Add More Software and Renderer">Add More<span class="fa fa-plus marginL10" aria-hidden="true"></span></button></div></div></div><input type="hidden" id="count_software_renderer_'+k+'" value="'+l+'">';

                j = j +1;
                k = k +1;
            };
         }   
       
        setTimeout(function() {
            $('#output_zip').html(outputhtml);
        }, 500); 
             
    });

    check_free();
    $('#rcfree').click(function(){  
        check_free();
    });

    function check_free(){
       if($('#rcfree'). prop("checked") === true){
            $("#price").val('');
            $("#price").prop('disabled',true);
        }else{
            $("#price").prop('disabled',false);
        } 
    }

    check_uv_mapping();
    $('#uv_mapping').click(function(){
        check_uv_mapping();
    });

    check_download_license_type();
    $('#download_license_type').change(function(){
        check_download_license_type();
    });

 });

 function check_uv_mapping(){

    if($('#uv_mapping').prop("checked") === true){
        $("#UnwrappedUVsDiv").show();
    }else{
        $("#UnwrappedUVsDiv").hide();
        $("#download_unwrapped_uv").val('');
        var txt = $("#download_unwrapped_uv :selected").text();

        $("#UnwrappedUVsDiv .select-wrapper .holder").html(txt);
    }

 } 

 function check_download_license_type(){
    if($('#download_license_type').val() == 'Custom'){
        $("#LicenseCustomInfoDiv").show();
    }else{
        $("#LicenseCustomInfoDiv").hide();
        $("#license_custom_info").val('');
    }
 }  

 function removethumb(rt,k){
    $('li#li'+rt).hide();

    var removedid = $('#gallery_removedids').val();
    if(removedid == ''){
        removedid = k;
    }else{
        removedid = removedid + ',' +k;
    }

    $('#gallery_removedids').val(removedid);
 }

 function removezip(rt,k){
    $('div#lizip'+rt).hide();

    var removedid = $('#gallery_removedzip_new').val();
    if(removedid == ''){
        removedid = k;
    }else{
        removedid = removedid + ',' +k;
    }

    $('#gallery_removedzip_new').val(removedid);
 }

 function addMoreSoftwareRenderer(j, k){
    
    var l = parseInt($("#count_software_renderer_" + k).val());

    l++;
    $("#count_software_renderer_" + k).val(l);

    var html_div = '<div id="lizip_child'+j+'_'+l+'"><div class="form-group clearfix marginB10"><div class="gallery-select-top clearfix"><button class="lightbtn padding5 lightcolor pull-right addMoreBtn" type="button" onclick="removeSoftwareRenderer('+j+', '+l+')" title="Remove Software and Renderer">Remove<span class="fa fa-times marginL10" aria-hidden="true"></span></button></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><select class="custom-select" name="download[software_renderer]['+k+']['+l+'][software]" id="gallery_zip_software_used_'+j+'_'+l+'"><% @software_expertise.each_with_index do |value, index| %><option value="<%= value[1] %>"><%= value[0] %></option><% end %></select></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><input type="text" name="download[software_renderer]['+k+']['+l+'][software_version]" id="gallery_zip_software_version_'+j+'_'+l+'" class="form-control from-input" placeholder="Enter Software Version"></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><select class="custom-select" name="download[software_renderer]['+k+']['+l+'][renderer]" id="gallery_zip_renderer_'+j+'_'+l+'"><% @renderer.each_with_index do |value, index| %><option value="<%= value[1] %>"><%= value[0] %></option><% end %></select></div><div class="col-md-6 col-sm-6 col-xs-6 marginB10"><input type="text" name="download[software_renderer]['+k+']['+l+'][renderer_version]" id="gallery_zip_renderer_version_'+j+'_'+l+'" class="form-control from-input" placeholder="Enter Renderer Version"></div></div></div>';

    $("#softwareRendererDiv" + k).append(html_div);

 }

 function removeSoftwareRenderer(j, l){
    $("#lizip_child" + j + "_" + l).html('');
 }

	$('#download_use_tag_from_previous_upload').click(function(){
		var previous_tags = <%= previous_tags.to_json.html_safe %>;

		if($(this). prop("checked") === true){
		    $( previous_tags ).each(function( index ) {
		        $("#tag").append($('<option>', {value: this, text: this}));
		    });
		    $('#tag option').prop('selected', true);
		}else{
		    $( previous_tags ).each(function( index ) {
		        $("#tag option[value='" + this + "']").remove();
		    });
		}

	});

</script>
<script type="text/javascript">
    $(function () {
        $('#closing_date').datetimepicker({

    startDate: '-0d',
    weekStart: 1,
    todayBtn:  1,
    autoclose: 1,
    todayHighlight: 1,
    startView: 2,
    minView: 2,
    forceParse: 0,
    dateFormat: 'mm-dd-yy', 
    changeMonth: true,
    changeYear: true,
    yearRange: '-70:+10',
        });
    });

 
</script>